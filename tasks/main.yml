---
- name: Install TigerVNC server
  yum:
    name: tigervnc-server
  become: true

- name: Configure GDM
  ini_file:
    line: Enable=true
    path: /etc/gdm/custom.conf
    section: xdmcp
    option: Enable
    value: true
  become: true
  notify:
    - Restart VNC service
    - Restart GDM

- name: Configure firewall
  firewalld:
    service: vnc_server
    permanent: yes
    immediate: yes
    state: enabled
  when: configure_firewall

- name: Start and enable VNC socket
  tags: notest
  systemd:
    enabled: true
    name: xvnc.socket
    state: started
  become: true
